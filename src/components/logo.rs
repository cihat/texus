use std::time::Instant;

use ansi_to_tui::IntoText;
use ratatui::{
  buffer::Buffer,
  layout::Rect,
  style::{Color, Style, Stylize},
  text::Text,
  widgets::{Widget, WidgetRef},
};

const LOGO: &str = "
\x1b[49m                                                \x1b[m
\x1b[49m                                                \x1b[m
\x1b[49m                                                \x1b[m
\x1b[49m                  \x1b[38;5;234;49m▄\x1b[38;5;235;49m▄\x1b[38;5;234;49m▄\x1b[38;5;236;48;5;233m▄\x1b[38;5;251;48;5;236m▄\x1b[38;5;229;48;5;237m▄\x1b[38;5;221;48;5;237m▄\x1b[38;5;142;48;5;235m▄\x1b[38;5;235;48;5;234m▄\x1b[38;5;234;49m▄▄\x1b[38;5;233;49m▄\x1b[38;5;243;49m▄\x1b[49m                 \x1b[m
\x1b[49m               \x1b[38;5;234;49m▄\x1b[38;5;233;48;5;234m▄\x1b[38;5;152;48;5;234m▄\x1b[38;5;153;48;5;237m▄\x1b[38;5;24;48;5;234m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;229;48;5;188m▄\x1b[38;5;220;48;5;227m▄\x1b[38;5;220;48;5;220m▄▄▄\x1b[38;5;70;48;5;64m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;8;48;5;233m▄\x1b[38;5;254;48;5;237m▄\x1b[38;5;64;48;5;234m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;233;49m▄\x1b[49m               \x1b[m
\x1b[49m          \x1b[38;5;235;49m▄\x1b[38;5;234;49m▄\x1b[38;5;235;48;5;237m▄\x1b[38;5;237;48;5;234m▄\x1b[38;5;234;48;5;234m▄▄▄\x1b[38;5;234;48;5;23m▄\x1b[38;5;234;48;5;24m▄\x1b[38;5;234;48;5;23m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;235;48;5;3m▄\x1b[38;5;106;48;5;184m▄\x1b[38;5;106;48;5;220m▄▄\x1b[38;5;64;48;5;106m▄\x1b[38;5;235;48;5;58m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;234;48;5;236m▄▄\x1b[38;5;234;48;5;235m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;234;48;5;233m▄\x1b[38;5;233;48;5;234m▄\x1b[38;5;235;48;5;234m▄\x1b[38;5;235;48;5;236m▄\x1b[38;5;234;49m▄\x1b[38;5;236;49m▄\x1b[49m          \x1b[m
\x1b[49m         \x1b[38;5;235;49m▄\x1b[38;5;245;48;5;237m▄\x1b[38;5;153;48;5;253m▄\x1b[38;5;81;48;5;195m▄\x1b[38;5;38;48;5;117m▄\x1b[38;5;38;48;5;38m▄\x1b[38;5;6;48;5;235m▄\x1b[38;5;234;48;5;233m▄\x1b[38;5;234;48;5;234m▄▄▄\x1b[38;5;234;49m▄\x1b[38;5;234;48;5;235m▄\x1b[38;5;237;48;5;235m▄\x1b[38;5;234;48;5;236m▄\x1b[38;5;234;48;5;235m▄\x1b[38;5;237;48;5;235m▄\x1b[38;5;234;48;5;236m▄\x1b[38;5;234;49m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;233;48;5;234m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;234;48;5;233m▄\x1b[38;5;152;48;5;237m▄\x1b[38;5;117;48;5;15m▄\x1b[38;5;39;48;5;195m▄\x1b[38;5;38;48;5;74m▄\x1b[38;5;38;48;5;37m▄\x1b[38;5;23;48;5;235m▄\x1b[38;5;239;48;5;236m▄\x1b[49m         \x1b[m
\x1b[49m         \x1b[38;5;234;48;5;234m▄\x1b[38;5;23;48;5;245m▄\x1b[38;5;38;48;5;81m▄\x1b[38;5;38;48;5;38m▄▄▄\x1b[38;5;24;48;5;24m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;234;48;5;249m▄\x1b[38;5;237;48;5;188m▄\x1b[38;5;234;48;5;188m▄\x1b[38;5;234;48;5;66m▄\x1b[38;5;234;48;5;235m▄\x1b[38;5;234;48;5;60m▄\x1b[38;5;233;48;5;235m▄\x1b[38;5;234;48;5;233m▄\x1b[38;5;234;48;5;237m▄\x1b[38;5;234;48;5;235m▄▄\x1b[38;5;234;48;5;7m▄\x1b[38;5;234;48;5;188m▄\x1b[38;5;234;48;5;249m▄\x1b[38;5;234;48;5;239m▄\x1b[38;5;31;48;5;74m▄\x1b[38;5;38;48;5;38m▄▄▄\x1b[38;5;31;48;5;38m▄\x1b[38;5;23;48;5;23m▄\x1b[38;5;234;48;5;234m▄\x1b[49m         \x1b[m
\x1b[49m         \x1b[38;5;233;48;5;234m▄\x1b[38;5;236;48;5;23m▄\x1b[38;5;236;48;5;24m▄\x1b[38;5;235;48;5;31m▄▄\x1b[38;5;235;48;5;24m▄\x1b[38;5;240;48;5;23m▄\x1b[38;5;236;48;5;235m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;110;48;5;110m▄\x1b[38;5;234;48;5;234m▄\x1b[49m \x1b[38;5;237;49m▄\x1b[38;5;59;48;5;235m▄\x1b[38;5;252;48;5;234m▄\x1b[38;5;108;48;5;234m▄\x1b[38;5;236;48;5;238m▄\x1b[38;5;59;49m▄\x1b[49m \x1b[38;5;234;48;5;234m▄▄▄\x1b[49;38;5;234m▀\x1b[38;5;241;48;5;23m▄\x1b[38;5;235;48;5;31m▄▄\x1b[38;5;235;48;5;24m▄\x1b[38;5;236;48;5;24m▄\x1b[38;5;239;48;5;236m▄\x1b[38;5;234;48;5;234m▄\x1b[49m         \x1b[m
\x1b[49m       \x1b[38;5;234;49m▄\x1b[38;5;234;48;5;233m▄\x1b[38;5;66;48;5;233m▄\x1b[38;5;23;48;5;233m▄\x1b[38;5;234;49m▄\x1b[38;5;245;48;5;236m▄\x1b[38;5;59;48;5;234m▄\x1b[38;5;235;48;5;234m▄\x1b[38;5;234;49m▄\x1b[38;5;234;48;5;235m▄\x1b[38;5;66;48;5;234m▄\x1b[38;5;252;48;5;237m▄\x1b[38;5;235;48;5;234m▄\x1b[38;5;234;48;5;235m▄\x1b[38;5;255;48;5;59m▄\x1b[38;5;187;48;5;15m▄\x1b[38;5;149;48;5;149m▄\x1b[38;5;149;48;5;113m▄▄\x1b[38;5;237;48;5;236m▄\x1b[38;5;234;48;5;236m▄\x1b[38;5;240;48;5;234m▄\x1b[38;5;253;48;5;237m▄\x1b[38;5;235;48;5;234m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;234;49m▄\x1b[38;5;236;48;5;234m▄\x1b[38;5;245;48;5;237m▄\x1b[38;5;237;48;5;235m▄\x1b[38;5;234;49m▄\x1b[38;5;240;48;5;234m▄\x1b[38;5;245;48;5;234m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;234;49m▄\x1b[49m       \x1b[m
\x1b[49m       \x1b[49;38;5;234m▀\x1b[38;5;234;48;5;235m▄\x1b[38;5;234;48;5;81m▄\x1b[38;5;234;48;5;23m▄\x1b[38;5;243;48;5;234m▄\x1b[38;5;234;48;5;149m▄\x1b[38;5;235;48;5;107m▄\x1b[38;5;234;48;5;236m▄\x1b[38;5;243;48;5;237m▄\x1b[38;5;237;48;5;236m▄\x1b[38;5;234;48;5;142m▄\x1b[38;5;235;48;5;148m▄\x1b[38;5;234;48;5;237m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;238;48;5;149m▄\x1b[38;5;71;48;5;149m▄\x1b[38;5;113;48;5;149m▄▄\x1b[38;5;71;48;5;70m▄\x1b[38;5;23;48;5;2m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;234;48;5;65m▄\x1b[38;5;235;48;5;185m▄\x1b[38;5;234;48;5;64m▄\x1b[38;5;235;48;5;238m▄▄\x1b[38;5;234;48;5;236m▄\x1b[38;5;235;48;5;149m▄\x1b[38;5;235;48;5;106m▄\x1b[38;5;238;48;5;234m▄\x1b[38;5;234;48;5;239m▄\x1b[38;5;234;48;5;110m▄\x1b[38;5;234;48;5;235m▄\x1b[49;38;5;234m▀\x1b[49m       \x1b[m
\x1b[49m         \x1b[38;5;234;48;5;233m▄▄▄\x1b[38;5;188;48;5;233m▄\x1b[38;5;186;48;5;234m▄\x1b[38;5;236;48;5;234m▄\x1b[38;5;234;49m▄\x1b[49m \x1b[48;5;234m \x1b[38;5;109;48;5;60m▄\x1b[38;5;234;48;5;234m▄\x1b[49m \x1b[38;5;238;48;5;237m▄\x1b[38;5;235;48;5;235m▄\x1b[38;5;235;48;5;2m▄▄\x1b[38;5;235;48;5;22m▄\x1b[38;5;240;48;5;237m▄\x1b[49m \x1b[38;5;234;48;5;234m▄▄▄\x1b[49m \x1b[38;5;233;49m▄\x1b[38;5;237;48;5;234m▄\x1b[38;5;253;48;5;234m▄\x1b[38;5;38;48;5;234m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;234;48;5;233m▄\x1b[38;5;234;48;5;234m▄\x1b[49m         \x1b[m
\x1b[49m         \x1b[38;5;234;48;5;234m▄\x1b[38;5;245;48;5;102m▄\x1b[38;5;228;48;5;15m▄\x1b[38;5;220;48;5;221m▄\x1b[38;5;220;48;5;220m▄▄\x1b[38;5;58;48;5;3m▄\x1b[38;5;235;48;5;234m▄\x1b[38;5;59;48;5;234m▄\x1b[38;5;60;48;5;67m▄\x1b[38;5;66;48;5;234m▄\x1b[38;5;242;48;5;234m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;240;48;5;236m▄\x1b[38;5;245;48;5;234m▄\x1b[38;5;8;48;5;234m▄\x1b[38;5;237;48;5;60m▄\x1b[38;5;235;48;5;236m▄\x1b[38;5;240;49m▄\x1b[38;5;239;48;5;234m▄\x1b[38;5;60;48;5;234m▄\x1b[38;5;238;48;5;234m▄\x1b[38;5;235;48;5;234m▄\x1b[38;5;116;48;5;251m▄\x1b[38;5;117;48;5;195m▄\x1b[38;5;39;48;5;38m▄\x1b[38;5;38;48;5;38m▄▄\x1b[38;5;23;48;5;23m▄\x1b[38;5;234;48;5;234m▄\x1b[49m         \x1b[m
\x1b[49m         \x1b[38;5;234;48;5;236m▄\x1b[38;5;58;48;5;242m▄\x1b[38;5;184;48;5;220m▄▄▄\x1b[38;5;3;48;5;220m▄\x1b[38;5;64;48;5;64m▄\x1b[38;5;236;48;5;234m▄\x1b[38;5;234;48;5;236m▄\x1b[38;5;110;48;5;237m▄\x1b[38;5;238;48;5;237m▄\x1b[38;5;235;48;5;236m▄\x1b[38;5;230;48;5;237m▄\x1b[38;5;184;48;5;255m▄\x1b[38;5;184;48;5;185m▄\x1b[38;5;184;48;5;184m▄▄\x1b[38;5;64;48;5;235m▄\x1b[38;5;236;48;5;235m▄\x1b[38;5;241;48;5;235m▄\x1b[38;5;66;48;5;235m▄\x1b[38;5;235;48;5;235m▄\x1b[38;5;239;48;5;234m▄\x1b[38;5;24;48;5;38m▄\x1b[38;5;38;48;5;38m▄▄▄\x1b[38;5;24;48;5;38m▄\x1b[38;5;23;48;5;23m▄\x1b[38;5;236;48;5;234m▄\x1b[49m         \x1b[m
\x1b[49m         \x1b[49;38;5;234m▀\x1b[38;5;234;48;5;235m▄\x1b[38;5;234;48;5;236m▄\x1b[38;5;235;48;5;70m▄\x1b[38;5;236;48;5;70m▄\x1b[38;5;235;48;5;58m▄\x1b[38;5;237;48;5;235m▄\x1b[49;38;5;234m▀\x1b[38;5;234;48;5;234m▄\x1b[38;5;237;48;5;110m▄\x1b[38;5;238;48;5;234m▄\x1b[38;5;235;48;5;234m▄\x1b[38;5;235;48;5;185m▄\x1b[38;5;148;48;5;184m▄\x1b[38;5;184;48;5;184m▄▄\x1b[38;5;64;48;5;148m▄\x1b[38;5;234;48;5;64m▄\x1b[38;5;236;48;5;234m▄\x1b[38;5;240;48;5;234m▄\x1b[38;5;236;48;5;250m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;241;48;5;234m▄\x1b[38;5;236;48;5;23m▄\x1b[38;5;235;48;5;23m▄\x1b[38;5;236;48;5;24m▄\x1b[38;5;235;48;5;25m▄\x1b[38;5;234;48;5;23m▄\x1b[38;5;234;48;5;234m▄\x1b[49;38;5;234m▀\x1b[49m         \x1b[m
\x1b[49m             \x1b[49;38;5;249m▀\x1b[49;38;5;235m▀\x1b[38;5;239;48;5;234m▄\x1b[38;5;234;48;5;234m▄\x1b[38;5;74;48;5;188m▄\x1b[38;5;38;48;5;153m▄\x1b[38;5;24;48;5;24m▄\x1b[38;5;235;48;5;234m▄\x1b[38;5;234;48;5;236m▄\x1b[38;5;236;48;5;64m▄\x1b[38;5;235;48;5;64m▄\x1b[38;5;236;48;5;64m▄\x1b[38;5;238;48;5;64m▄\x1b[38;5;236;48;5;236m▄\x1b[38;5;239;48;5;234m▄\x1b[38;5;65;48;5;245m▄\x1b[38;5;107;48;5;255m▄\x1b[38;5;64;48;5;64m▄\x1b[38;5;234;48;5;234m▄▄\x1b[49;38;5;235m▀\x1b[49;38;5;102m▀\x1b[49m             \x1b[m
\x1b[49m                \x1b[49;38;5;241m▀\x1b[49;38;5;23m▀\x1b[38;5;242;48;5;23m▄\x1b[38;5;236;48;5;235m▄\x1b[38;5;235;48;5;236m▄\x1b[38;5;234;49m▄\x1b[38;5;234;48;5;247m▄\x1b[38;5;237;48;5;234m▄\x1b[38;5;237;48;5;235m▄\x1b[38;5;234;48;5;253m▄\x1b[38;5;234;49m▄\x1b[38;5;234;48;5;239m▄\x1b[38;5;235;48;5;236m▄▄\x1b[49;38;5;236m▀\x1b[49;38;5;102m▀\x1b[49m                \x1b[m
\x1b[49m                    \x1b[49;38;5;251m▀\x1b[49;38;5;233m▀\x1b[38;5;235;48;5;235m▄\x1b[38;5;64;48;5;186m▄\x1b[38;5;64;48;5;143m▄\x1b[38;5;237;48;5;236m▄\x1b[38;5;240;48;5;236m▄\x1b[49;38;5;234m▀\x1b[49m                    \x1b[m
\x1b[49m                      \x1b[49;38;5;245m▀\x1b[49;38;5;234m▀\x1b[49;38;5;235m▀\x1b[49;38;5;243m▀\x1b[49m                      \x1b[m
";

const WIDTH: u16 = 48;
const HEIGHT: u16 = 28;

#[derive(Debug)]
pub struct Logo {
  pub init_time: Instant,
  pub is_rendered: bool,
}

impl Default for Logo {
  fn default() -> Self {
    Self {
      init_time: Instant::now(),
      is_rendered: false,
    }
  }
}

impl WidgetRef for Logo {
  fn render_ref(&self, area: Rect, buf: &mut Buffer) {
    let text: Text = LOGO.into_text().expect("failed to parse ANSI");
    text.render(area, buf);
    let message = "Loading...";
    buf.set_string(
      WIDTH / 2 - message.len() as u16 / 2 + area.x,
      HEIGHT + area.y,
      message,
      Style::default().fg(Color::Rgb(248, 190, 117)).italic(),
    )
  }
}

impl Logo {
  /// Returns the size of the logo.
  pub fn get_size(&self) -> (u16, u16) {
    (WIDTH, HEIGHT)
  }
}
